---
id: ya137
name: Spider/scraper
file_version: 1.1.0
app_version: 1.0.0
---

# Overview
The spidering package provided a set of primitive functions which may be composed to create a web scraper.

The scraping primitives are defined in `ðŸ“„ packages/spider/src/app/scraping-primitives.ts`.

The composition functions are defined in `ðŸ“„ packages/spider/src/core/taskflow-defs.ts`.

An example of a function which takes a URL, deletes any prior downloaded artifacts for that URL, then fetches are writes the response body is:
```typescript
const runScraper: Transform<URL, unknown> = compose(
  cleanArtifacts,
  fetchUrl(),
  writeResponseBody()
);
```


# Command line
From the root of the project, run:

```> ./bin/run spider-url```

# Logging
```sh
âžœ bin/cli --env dev --log-level=verbose spider-url --corpus-root ./tmp.d --url 'https://doi.org/10.48550/arXiv.2205.02979'
run> node ./packages/services/dist/src/cli --log-level=verbose spider-url --corpus-root ./tmp.d --url https://doi.org/10.48550/arXiv.2205.02979
10:36:18:1818 verbose [browser-pool] pool/event: acquireRequest:1
10:36:18:1818 verbose [browser-pool] pool/event: createRequest:2
10:36:19:1919 verbose [browser-pool] pool/event: createSuccess:2: Browser#324380
10:36:19:1919 debug [browser-pool] validating Browser#324380
10:36:19:1919 verbose [browser-pool] pool/event: startReaping
10:36:19:1919 verbose [browser-pool] pool/event: acquireSuccess:1: Browser#324380
10:36:19:1919 verbose [browser-pool] Browser#324380: browserEvent: targetcreated, targetType: undefined, targetUrl: undefined
10:36:19:1919 debug [browser-pool] interceptPageEvents():begin
10:36:19:1919 debug [spider] [] Resource permissions:
10:36:19:1919 debug [spider] []    Blocked: cspviolationreport, eventsource, fetch, font, image, manifest, media, other, ping, preflight, script, stylesheet, signedexchange, texttrack, websocket, xhr, prefetch
10:36:19:1919 debug [spider] []    Allowed: document
10:36:19:1919 verbose [browser-pool] Browser#324380/pageEvent: domcontentloaded
10:36:19:1919 debug [browser-pool] Aborting rewritable url https://doi.org/10.48550/arXiv.2205.02979
10:36:19:1919 debug [browser-pool] B<324380> / Fail<7FA4422E9AAC1CCBC93FD2FB3972167D> resource: document https://doi.org/10.48550/arXiv.2205.02979, requestfailed
10:36:19:1919 debug [spider] [] Attempting Rewrite for Error: net::ERR_BLOCKED_BY_CLIENT at https://doi.org/10.48550/arXiv.2205.02979
10:36:19:1919 debug [spider] []  Rewrite url https://doi.org/10.48550/arXiv.2205.02979
10:36:19:1919 info [spider] [] Rewrote https://doi.org/10.48550/arXiv.2205.02979 to http://export.arxiv.org/api/query?id_list=2205.02979
Document (request id: F89EAC554D247B5493695BB354A478BF) resource url http://export.arxiv.org/api/query?id_list=2205.02979
10:36:19:1919 verbose [browser-pool] Browser#324380: browserEvent: targetchanged, targetType: undefined, targetUrl: undefined
10:36:19:1919 verbose [browser-pool] Browser#324380/pageEvent: framenavigated
10:36:19:1919 debug [browser-pool] B<324380> / Success<F89EAC554D247B5493695BB354A478BF> resource: document http://export.arxiv.org/api/query?..., response, requestfinished
10:36:19:1919 verbose [browser-pool] Browser#324380/pageEvent: load
Spider success: {
  requestUrl: 'https://doi.org/10.48550/arXiv.2205.02979',
  responseUrl: 'http://export.arxiv.org/api/query?id_list=2205.02979',
  status: '200',
  fetchChain: [],
  timestamp: 'Tue, 03 Jan 2023 15:36:19 GMT'
}
10:36:19:1919 debug [browser-pool] pool.release(B<324380>)
10:36:19:1919 verbose [browser-pool] Browser#324380/pageEvent: domcontentloaded
10:36:19:1919 debug [browser-pool]     release(Page<about:blank>)
10:36:19:1919 debug [browser-pool]     release(Page<http://export.arxiv.org/api/query?id_list=2205.02979>)
10:36:19:1919 verbose [browser-pool] pool/event: release Browser#324380
10:36:19:1919 debug [browser-pool] pool.release(B<324380>): done
10:36:19:1919 debug [browser-pool] pool.shutdown()
10:36:19:1919 verbose [browser-pool] pool/event: poolDestroyRequest:3
10:36:19:1919 verbose [browser-pool] pool/event: stopReaping
10:36:19:1919 verbose [browser-pool] pool/event: destroyRequest:4: Browser#324380
10:36:19:1919 debug [browser-pool] Browser#324380 onExit: null
10:36:19:1919 debug [browser-pool] Browser#324380 closed
10:36:19:1919 verbose [browser-pool] pool/event: destroySuccess:4: Browser#324380
10:36:19:1919 verbose [browser-pool] pool/event: poolDestroySuccess:3
10:36:19:1919 debug [browser-pool] Browser#324380 onClose: null
10:36:19:1919 debug [browser-pool] Node process got null/0; cleaning up browser pool
```


# Browser page caching


<br/>

<br/>

This file was generated by Swimm. [Click here to view it in the app](https://app.swimm.io/repos/Z2l0aHViJTNBJTNBb3Blbi1tZXRhLWV4dHJhY3Rpb24lM0ElM0FhZGFtY2hhbmRyYQ==/docs/ya137).
